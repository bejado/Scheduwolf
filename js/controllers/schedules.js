app.filter('reverse', function() {
  return function(items) {
    return items.slice().reverse();
  };
});

function SchedulesCtrl ($scope, $routeParams, $http, $filter, $modal, Sections) {
	$scope.currentSchedule = {index: 0};
	$scope.testSolution = {};
	// $scope.testSolution = {"sections":[{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18060","type":"discussion","meetings":[{"startTime":[18,0],"days":[0,1,0,0,0,0,0],"endTime":[18,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30436","type":"lab","meetings":[{"startTime":[17,0],"days":[0,0,1,0,0,0,0],"endTime":[19,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18030","type":"discussion","meetings":[{"startTime":[11,0],"days":[0,0,0,1,0,0,0],"endTime":[11,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30416","type":"lecture","meetings":[{"startTime":[9,30],"days":[0,1,0,1,0,0,0],"endTime":[10,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18010","type":"discussion","meetings":[{"startTime":[10,0],"days":[0,1,0,0,0,0,0],"endTime":[10,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30979","type":"lab","meetings":[{"startTime":[13,0],"days":[0,0,0,0,1,0,0],"endTime":[15,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30434","type":"lab","meetings":[{"startTime":[18,0],"days":[1,0,0,0,0,0,0],"endTime":[20,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Principles of Software Development","sectionNumber":"30380","type":"lab","meetings":[{"startTime":[12,0],"days":[0,0,1,0,0,0,0],"endTime":[13,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Introduction to Cinema","sectionNumber":"18130","type":"discussion","meetings":[{"startTime":[13,0],"days":[0,0,1,0,0,0,0],"endTime":[13,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30440","type":"lecture-lab","meetings":[{"startTime":[16,0],"days":[0,0,0,0,1,0,0],"endTime":[18,0]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18015","type":"discussion","meetings":[{"startTime":[10,0],"days":[0,0,0,1,0,0,0],"endTime":[10,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30978","type":"discussion","meetings":[{"startTime":[24,24],"days":[0,0,0,0,0,0,0],"endTime":[24,24]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Principles of Software Development","sectionNumber":"29930","type":"lab","meetings":[{"startTime":[10,0],"days":[0,0,1,0,0,0,0],"endTime":[11,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18020","type":"discussion","meetings":[{"startTime":[10,0],"days":[0,0,0,0,1,0,0],"endTime":[10,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Principles of Software Development","sectionNumber":"30381","type":"lecture","meetings":[{"startTime":[11,0],"days":[0,1,0,1,0,0,0],"endTime":[12,20]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30966","type":"lab","meetings":[{"startTime":[9,0],"days":[0,0,0,0,1,0,0],"endTime":[11,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30420","type":"lecture","meetings":[{"startTime":[10,30],"days":[1,0,1,0,0,0,0],"endTime":[11,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18000","type":"lecture","meetings":[{"startTime":[14,0],"days":[0,1,0,0,0,0,0],"endTime":[17,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18045","type":"discussion","meetings":[{"startTime":[13,0],"days":[1,0,0,0,0,0,0],"endTime":[13,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18025","type":"discussion","meetings":[{"startTime":[11,0],"days":[0,1,0,0,0,0,0],"endTime":[11,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Principles of Software Development","sectionNumber":"29928","type":"lecture","meetings":[{"startTime":[14,0],"days":[1,0,1,0,0,0,0],"endTime":[15,20]}]},{"location":"Cosmo\u0027s Apartment","status":"Closed","courseTitle":"Introduction to Digital Circuits","sectionNumber":"30976","type":"lab","meetings":[{"startTime":[17,0],"days":[0,0,0,1,0,0,0],"endTime":[19,50]}]},{"location":"Cosmo\u0027s Apartment","status":"Open","courseTitle":"Introduction to Cinema","sectionNumber":"18035","type":"discussion","meetings":[{"startTime":[12,0],"days":[1,0,0,0,0,0,0],"endTime":[12,50]}]}],"solutions":[{"sections":["30978","29930","18020","30416","30381","30434","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.4,"Class time on Friday":2.833333333333334}},{"sections":["30978","29930","30416","30381","30434","18000","30440","18035"],"stats":{"Total class time":14.0,"Average start time":11.4,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30381","30434","18000","18045","30440"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18060","30978","29930","30416","30381","30434","18000","30440"],"stats":{"Total class time":13.999999999999998,"Average start time":12.6,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30381","30434","18130","18000","30440"],"stats":{"Total class time":14.0,"Average start time":12.6,"Class time on Friday":2.0}},{"sections":["30436","30978","29930","18020","30416","30381","18000","30440"],"stats":{"Total class time":14.0,"Average start time":9.75,"Class time on Friday":2.833333333333334}},{"sections":["30436","30978","29930","30416","30381","18000","30440","18035"],"stats":{"Total class time":14.0,"Average start time":11.4,"Class time on Friday":2.0}},{"sections":["30436","30978","29930","30416","30381","18000","18045","30440"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18060","30436","30978","29930","30416","30381","18000","30440"],"stats":{"Total class time":13.999999999999998,"Average start time":11.25,"Class time on Friday":2.0}},{"sections":["30436","30978","29930","30416","30381","18130","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.25,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30381","30966","18000","30440","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":10.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30381","30966","18000","18045","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":10.2,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","29930","30416","30381","30966","18000","30440"],"stats":{"Total class time":14.0,"Average start time":9.5,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30381","30966","18130","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":9.5,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","18020","30416","30381","18000","30440","30976"],"stats":{"Total class time":14.0,"Average start time":9.75,"Class time on Friday":2.833333333333334}},{"sections":["30978","29930","30416","30381","18000","30440","30976","18035"],"stats":{"Total class time":14.0,"Average start time":11.4,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30381","18000","18045","30440","30976"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18060","30978","29930","30416","30381","18000","30440","30976"],"stats":{"Total class time":13.999999999999998,"Average start time":11.25,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30381","18130","18000","30440","30976"],"stats":{"Total class time":14.0,"Average start time":11.25,"Class time on Friday":2.0}},{"sections":["30978","29930","18020","30416","30381","30979","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":9.75,"Class time on Friday":5.666666666666668}},{"sections":["30978","29930","30416","30381","30979","18000","30440","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":10.8,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30381","30979","18000","18045","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","29930","30416","30381","30979","18000","30440"],"stats":{"Total class time":14.0,"Average start time":10.5,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30381","30979","18130","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":10.5,"Class time on Friday":4.833333333333334}},{"sections":["30978","18020","30416","30381","30434","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.833333333333334}},{"sections":["30978","30416","30381","30434","30380","18000","30440","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","30416","30381","30434","30380","18000","18045","30440"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":2.0}},{"sections":["18060","30978","30416","30381","30434","30380","18000","30440"],"stats":{"Total class time":13.999999999999998,"Average start time":13.0,"Class time on Friday":2.0}},{"sections":["30436","30978","18020","30416","30381","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":10.25,"Class time on Friday":2.833333333333334}},{"sections":["30436","30978","30416","30381","30380","18000","30440","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30436","30978","30416","30381","30380","18000","18045","30440"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":2.0}},{"sections":["18060","30436","30978","30416","30381","30380","18000","30440"],"stats":{"Total class time":13.999999999999998,"Average start time":11.75,"Class time on Friday":2.0}},{"sections":["30978","30416","30381","30966","30380","18000","30440","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["30978","30416","30381","30966","30380","18000","18045","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":10.6,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","30416","30381","30966","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":10.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","18020","30416","30381","30380","18000","30440","30976"],"stats":{"Total class time":14.0,"Average start time":10.25,"Class time on Friday":2.833333333333334}},{"sections":["30978","30416","30381","30380","18000","30440","30976","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","30416","30381","30380","18000","18045","30440","30976"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":2.0}},{"sections":["18060","30978","30416","30381","30380","18000","30440","30976"],"stats":{"Total class time":13.999999999999998,"Average start time":11.75,"Class time on Friday":2.0}},{"sections":["30978","18020","30416","30381","30979","30380","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":10.25,"Class time on Friday":5.666666666666668}},{"sections":["30978","30416","30381","30979","30380","18000","30440","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","30416","30381","30979","30380","18000","18045","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":11.4,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","30416","30381","30979","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","30381","18010","30434","30420","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18015","30978","30381","30434","30420","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["30978","18020","30381","30434","30420","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":10.6,"Class time on Friday":2.833333333333334}},{"sections":["30978","30381","30434","30420","30380","18000","30440","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","30381","30434","30420","30380","18000","18045","30440"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["18060","30978","30381","30434","30420","30380","18000","30440"],"stats":{"Total class time":13.999999999999998,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30436","30978","30381","18010","30420","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18015","30436","30978","30381","30420","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["30436","30978","18020","30381","30420","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":10.6,"Class time on Friday":2.833333333333334}},{"sections":["30436","30978","30381","30420","30380","18000","30440","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30436","30978","30381","30420","30380","18000","18045","30440"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["18060","30436","30978","30381","30420","30380","18000","30440"],"stats":{"Total class time":13.999999999999998,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","30381","18010","30966","30420","30380","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":10.2,"Class time on Friday":4.833333333333334}},{"sections":["18015","30978","30381","30966","30420","30380","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":10.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","30381","30966","30420","30380","18000","30440","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["30978","30381","30966","30420","30380","18000","18045","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","30381","30966","30420","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["30978","30381","18010","30420","30380","18000","30440","30976"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18015","30978","30381","30420","30380","18000","30440","30976"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["30978","18020","30381","30420","30380","18000","30440","30976"],"stats":{"Total class time":14.0,"Average start time":10.6,"Class time on Friday":2.833333333333334}},{"sections":["30978","30381","30420","30380","18000","30440","30976","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","30381","30420","30380","18000","18045","30440","30976"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["18060","30978","30381","30420","30380","18000","30440","30976"],"stats":{"Total class time":13.999999999999998,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","30381","18010","30979","30420","30380","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["18015","30978","30381","30979","30420","30380","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","18020","30381","30979","30420","30380","18000","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":10.6,"Class time on Friday":5.666666666666668}},{"sections":["30978","30381","30979","30420","30380","18000","30440","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","30381","30979","30420","30380","18000","18045","30440"],"stats":{"Total class time":14.000000000000002,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","30381","30979","30420","30380","18000","30440"],"stats":{"Total class time":14.0,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","18020","30416","30434","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":10.6,"Class time on Friday":2.833333333333334}},{"sections":["30978","29930","30416","30434","18000","30440","18025","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","29930","18030","30416","30434","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30434","18000","30440","29928","18035"],"stats":{"Total class time":14.0,"Average start time":11.4,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30434","18000","18045","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18060","30978","29930","30416","30434","18000","30440","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30434","18130","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30436","30978","29930","18020","30416","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":10.6,"Class time on Friday":2.833333333333334}},{"sections":["30436","30978","29930","30416","18000","30440","18025","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30436","30978","29930","18030","30416","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30436","30978","29930","30416","18000","30440","29928","18035"],"stats":{"Total class time":14.0,"Average start time":11.4,"Class time on Friday":2.0}},{"sections":["30436","30978","29930","30416","18000","18045","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18060","30436","30978","29930","30416","18000","30440","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30436","30978","29930","30416","18130","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","30966","18000","30440","18025","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","18030","30416","30966","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30966","18000","30440","29928","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":10.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30966","18000","18045","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.2,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","29930","30416","30966","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30966","18130","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","18020","30416","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":10.6,"Class time on Friday":2.833333333333334}},{"sections":["30978","29930","30416","18000","30440","18025","30976","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","29930","18030","30416","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","18000","30440","30976","29928","18035"],"stats":{"Total class time":14.0,"Average start time":11.4,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","18000","18045","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":2.0}},{"sections":["18060","30978","29930","30416","18000","30440","30976","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","29930","30416","18130","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","29930","18020","30416","30979","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.6,"Class time on Friday":5.666666666666668}},{"sections":["30978","29930","30416","30979","18000","30440","18025","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","18030","30416","30979","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30979","18000","30440","29928","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":10.8,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30979","18000","18045","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","29930","30416","30979","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","29930","30416","30979","18130","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","18020","30416","30434","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.0,"Class time on Friday":2.833333333333334}},{"sections":["30978","30416","30434","30380","18000","30440","18025","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30978","18030","30416","30434","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30978","30416","30434","30380","18000","30440","29928","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","30416","30434","30380","18000","18045","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":2.0}},{"sections":["18060","30978","30416","30434","30380","18000","30440","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30436","30978","18020","30416","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.0,"Class time on Friday":2.833333333333334}},{"sections":["30436","30978","30416","30380","18000","30440","18025","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30436","30978","18030","30416","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30436","30978","30416","30380","18000","30440","29928","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30436","30978","30416","30380","18000","18045","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":2.0}},{"sections":["18060","30436","30978","30416","30380","18000","30440","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30978","30416","30966","30380","18000","30440","18025","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.8,"Class time on Friday":4.833333333333334}},{"sections":["30978","18030","30416","30966","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.8,"Class time on Friday":4.833333333333334}},{"sections":["30978","30416","30966","30380","18000","30440","29928","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":10.4,"Class time on Friday":4.833333333333334}},{"sections":["30978","30416","30966","30380","18000","18045","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.6,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","30416","30966","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":10.8,"Class time on Friday":4.833333333333334}},{"sections":["30978","18020","30416","30380","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":11.0,"Class time on Friday":2.833333333333334}},{"sections":["30978","30416","30380","18000","30440","18025","30976","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30978","18030","30416","30380","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30978","30416","30380","18000","30440","30976","29928","18035"],"stats":{"Total class time":14.0,"Average start time":11.8,"Class time on Friday":2.0}},{"sections":["30978","30416","30380","18000","18045","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":2.0}},{"sections":["18060","30978","30416","30380","18000","30440","30976","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30978","18020","30416","30979","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":5.666666666666668}},{"sections":["30978","30416","30979","30380","18000","30440","18025","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.6,"Class time on Friday":4.833333333333334}},{"sections":["30978","18030","30416","30979","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.6,"Class time on Friday":4.833333333333334}},{"sections":["30978","30416","30979","30380","18000","30440","29928","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":11.2,"Class time on Friday":4.833333333333334}},{"sections":["30978","30416","30979","30380","18000","18045","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.4,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","30416","30979","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.6,"Class time on Friday":4.833333333333334}},{"sections":["30978","18010","30434","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.75,"Class time on Friday":2.0}},{"sections":["18015","30978","30434","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30978","18020","30434","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.25,"Class time on Friday":2.833333333333334}},{"sections":["30978","30434","30420","30380","18000","30440","18025","29928"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":2.0}},{"sections":["30978","18030","30434","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.4,"Class time on Friday":2.0}},{"sections":["30978","30434","30420","30380","18000","30440","29928","18035"],"stats":{"Total class time":14.0,"Average start time":12.75,"Class time on Friday":2.0}},{"sections":["30978","30434","30420","30380","18000","18045","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.75,"Class time on Friday":2.0}},{"sections":["18060","30978","30434","30420","30380","18000","30440","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":12.75,"Class time on Friday":2.0}},{"sections":["30436","30978","18010","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.75,"Class time on Friday":2.0}},{"sections":["18015","30436","30978","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30436","30978","18020","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.25,"Class time on Friday":2.833333333333334}},{"sections":["30436","30978","30420","30380","18000","30440","18025","29928"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":2.0}},{"sections":["30436","30978","18030","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.4,"Class time on Friday":2.0}},{"sections":["30436","30978","30420","30380","18000","30440","29928","18035"],"stats":{"Total class time":14.0,"Average start time":12.75,"Class time on Friday":2.0}},{"sections":["30436","30978","30420","30380","18000","18045","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.75,"Class time on Friday":2.0}},{"sections":["18060","30436","30978","30420","30380","18000","30440","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":12.75,"Class time on Friday":2.0}},{"sections":["30978","18010","30966","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.0,"Class time on Friday":4.833333333333334}},{"sections":["18015","30978","30966","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.8,"Class time on Friday":4.833333333333334}},{"sections":["30978","30966","30420","30380","18000","30440","18025","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":10.25,"Class time on Friday":4.833333333333334}},{"sections":["30978","18030","30966","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","30966","30420","30380","18000","30440","29928","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","30966","30420","30380","18000","18045","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","30966","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","18010","30420","30380","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":12.8,"Class time on Friday":2.0}},{"sections":["18015","30978","30420","30380","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":12.2,"Class time on Friday":2.0}},{"sections":["30978","18020","30420","30380","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":12.4,"Class time on Friday":2.833333333333334}},{"sections":["30978","30420","30380","18000","30440","18025","30976","29928"],"stats":{"Total class time":14.0,"Average start time":13.0,"Class time on Friday":2.0}},{"sections":["30978","18030","30420","30380","18000","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":12.4,"Class time on Friday":2.0}},{"sections":["30978","30420","30380","18000","30440","30976","29928","18035"],"stats":{"Total class time":14.0,"Average start time":13.6,"Class time on Friday":2.0}},{"sections":["30978","30420","30380","18000","18045","30440","30976","29928"],"stats":{"Total class time":14.0,"Average start time":13.6,"Class time on Friday":2.0}},{"sections":["18060","30978","30420","30380","18000","30440","30976","29928"],"stats":{"Total class time":13.999999999999998,"Average start time":13.6,"Class time on Friday":2.0}},{"sections":["30978","18010","30979","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.0,"Class time on Friday":4.833333333333334}},{"sections":["18015","30978","30979","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.6,"Class time on Friday":4.833333333333334}},{"sections":["30978","18020","30979","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.25,"Class time on Friday":5.666666666666668}},{"sections":["30978","30979","30420","30380","18000","30440","18025","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.25,"Class time on Friday":4.833333333333334}},{"sections":["30978","18030","30979","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":11.8,"Class time on Friday":4.833333333333334}},{"sections":["30978","30979","30420","30380","18000","30440","29928","18035"],"stats":{"Total class time":14.000000000000002,"Average start time":12.0,"Class time on Friday":4.833333333333334}},{"sections":["30978","30979","30420","30380","18000","18045","30440","29928"],"stats":{"Total class time":14.000000000000002,"Average start time":12.0,"Class time on Friday":4.833333333333334}},{"sections":["18060","30978","30979","30420","30380","18000","30440","29928"],"stats":{"Total class time":14.0,"Average start time":12.0,"Class time on Friday":4.833333333333334}}]};
	$scope.courses = [];
	$scope.newCourse = {name:""};
	$scope.priorities = {priorities: ["No class on Friday", "Later start times", "Less overall class time", "Days of class per week"]};
	$scope.needsUpdate = {val: true};
	$scope.totalUnits = 0;

	function updateTotalUnits () {
		var newTotal = 0;
		for (var i = 0; i < $scope.courses.length; i++) {
			var thisCourse = $scope.courses[i];
			newTotal += thisCourse.units;
		}
		$scope.totalUnits = newTotal;
	}

	$scope.nextSchedule = function () {
		$scope.currentSchedule.index++;
	}

	$scope.previousSchedule = function () {
		$scope.currentSchedule.index--;
	}

	$scope.nextButtonEnabled = function () {
		if ($scope.testSolution.solutions) {
			if ($scope.currentSchedule.index >= $scope.testSolution.solutions.length - 1) {
				return false;
			}
			return true;
			}
		return false;
	}

	$scope.previousButtonEnabled = function () {
		if ($scope.testSolution.solutions) {
			if ($scope.currentSchedule.index <= 0) {
				return false;
			}
			return true;
			}
		return false;
	}

	$scope.updateSchedules = function () {
		// Extract the identifiers and section excludes from the course objects
		var courseIDs = [];
		var sectionExl = [];
		for (index = 0; index < $scope.courses.length; index++) {
			courseIDs.push($scope.courses[index].id);

			var sections = $scope.courses[index].sections;
			for (var s = 0; s < sections.length; s++) {
				thisSection = sections[s];
				if (!thisSection.checked) {
					sectionExl.push(thisSection.id);
				}
			}
		}

		// Turn the parameters into JSON objects
		var stringifiedCourses = JSON.stringify(courseIDs);
		var stringifiedPriorities = JSON.stringify($scope.priorities.priorities);
		var stringifiedSectionExl = JSON.stringify(sectionExl);

		// Make the GET request
		$http.get('/api/schedule', {
			params : {
				'courses': stringifiedCourses,
				'priorities': stringifiedPriorities,
				'exclude_sec': stringifiedSectionExl
			}
		}).
		success( function (data, status) {
			$scope.testSolution = data;
			$scope.currentSchedule.index = 0;
			$scope.needsUpdate.val = false;
		}).
		error( function (data, status, headers, config) {
			alert("Oh no! There was a server error :(");
		});
	}

	$scope.courseSelected = function (course) {
		$scope.addCourse(course);
	}

	$scope.removeCourse = function ($course) {
		var i = $scope.courses.indexOf($course);
		$scope.courses.splice(i, 1);
		$scope.needsUpdate.val = true;
		if ($scope.courses.length > 0) {
			$scope.updateSchedules();
		} else {
			$scope.testSolution = {};
		}
		updateTotalUnits();
	}	

	$scope.addCourse = function ($course) {
		var i = $scope.courses.indexOf($course);
		if (i == -1) {
			$scope.courses.push($course);
			Sections.getSections($course.department, $course.number, function (data, status) {
				$course.sections = data;
				var sections = $course.sections;
				for (var j = 0; j < sections.length; j++) {
					var thisSection = sections[j];
					thisSection.checked = true;
					/* restricts sections to only those open
					if (thisSection.canceled == "Y" || thisSection.number_registered >= thisSection.spaces_available) {
						thisSection.checked = false;
					}
					*/
				}

				// Make a call to the server to update the schedules
				$scope.updateSchedules();
			});
			updateTotalUnits();
		} else {
			alert("That course is already in your bin.");
		}
		$scope.newCourse.name = '';
		$scope.needsUpdate.val = true;
	}

	$scope.updateClass = function () {
		if ($scope.needsUpdate.val) {
			return "success";
		}
		return "default"
	}

	$scope.editCourseSections = function (course) {
		var modalInstance = $modal.open({
			templateUrl: "partials/editSections.html",
			controller: EditSectionsCtrl,
			resolve: {
				course: function () {
					return course;
				}
			}
		});
		modalInstance.result.then(function () {
			$scope.updateSchedules();
		}, function () {
			// nothing to do
		});
		$scope.updateSchedules();
	}

	$scope.viewSectionNumbers = function () {
		if ($scope.testSolution != {}) {
			// Grab the section numbers
			var sectionNumbers = $scope.testSolution.solutions[$scope.currentSchedule.index].sections;
			var sections = $scope.testSolution.sections;
			var sectionNumbersMap = {}

			// Go through each section number in the solution
			for (var i = 0; i < sectionNumbers.length; i++) {
				var thisSectionNumber = sectionNumbers[i];

				// Find the corresponding section object
				var foundId = -1;
				for (var j = 0; j < sections.length; j++) {
					if (sections[j].sectionNumber == thisSectionNumber) {
						foundId = j;
						break;
					}
				}

				// Store it in the map
				if (foundId != -1) {
					var foundSection = sections[foundId];

					// Is there already an entry?
					var thisMapObject = sectionNumbersMap[foundSection.courseTitle];

					if (thisMapObject) {
						thisMapObject.sections.push(foundSection.sectionNumber);
					} else {
						sectionNumbersMap[foundSection.courseTitle] = {sections: [ foundSection.sectionNumber ]};
					}
				}
			}

			var modalInstance = $modal.open({
				templateUrl: "partials/saveSchedule.html",
				controller: SaveScheduleCtrl,
				resolve: {
					sectionNumbers: function () {
						return sectionNumbersMap
					}
				}
			});
		}
	}
}